---
import ProductCard from "../components/productcard.astro";
let products = [] as Array<{ id: number, name: string, description: string, price: number, imageUrl: string }>;

const fetchProducts = async () => {
  try {
    const response = await fetch("https://commercial-api.vulktech.com/products");
    if (response.ok) {
      const data = await response.json();
      products = data.productList; // Ahora accedemos a productList
    } else {
      console.error("Failed to fetch products");
    }
  } catch (error) {
    console.error("Error:", error);
  }
};

// Llamamos a la función de carga de productos cuando la página se construye.
await fetchProducts();
---

<html>
  <head>
    <link rel="stylesheet" href="/src/styles/styles.css" />
  </head>
  <body>
    <div>
      <div class="home-page container">
        <h1 class="welcome-title">Bienvenido a eCommerce</h1>
      </div>
    </div>
    <div>
      <div class="product-list">
        <!-- Iteramos sobre los productos -->
        {products.length > 0 ? (
          products.map((product) => (
            <ProductCard product={product} />
          ))
        ) : (
          <p>No hay productos disponibles.</p>
        )}
      </div>
    </div>
  </body>
</html>
